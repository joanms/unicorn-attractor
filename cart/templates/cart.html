{% extends "base.html" %}

{% load bootstrap_tags %} 

{% load mathfilters %}

{% block page_title %}Cart{% endblock %}

{% block content %}

<div class="mx-auto regular-container">
    <h1>Cart Total: €{{ total }}</h1>
    
    {% if cart_items %}
    
        <!--If there are items in the cart, they will appear here-->
        <div class="flex-container">
        
            {% for item in cart_items %}
                <div class="card" style="width: 18rem;">
                    
                    <div class="card-body">
                        <h2>{{ item.feature.title }}</h2>
                        <p> {{ item.feature.description|truncatewords:20 }}
                        <p>
                            <strong>Price:</strong> €<span id='price'>{{ item.price }}</span>
                            <button type="submit" class="btn btn-secondary btn-sm" id="plus-one"><i class="fas fa-plus"></i></button>
                            <button type="submit" class="btn btn-secondary btn-sm" id="minus-one"><i class="fas fa-minus"></i></button>
                        </p>
                        <form class="price-change" method="post" action="{% url 'delete_item' item.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-secondary btn-sm">Delete</button>
                        </form>
                    </div>
                    
                </div>

        {% endfor %}
        
        </div>
        
        <div class="text-center">
            <a class="btn btn-secondary" href="{% url 'checkout' %}">Checkout</a>
            <a class="btn btn-secondary" href="{% url 'all_features' %}">Add Another Feature</a>
        </div>
            
    {% else %}
    
        <!--If there are no items in the cart, the following text will appear-->
        <p>Your cart is empty. Look for features to upvote <a href="{% url 'all_features' %}">here</a>.</p>
        
    {% endif %}
    
</div>

<script type="text/javascript">
    $('#plus-one').click(function() {
        $.get('/cart/add_one/').done(function(response) {
            // result goes here
            console.log(response);
            // response = {
            //     'new_price': '6'
            // }
            
            // $('#price').text(response.new_price);
        })
    })
</script>

{% endblock %}